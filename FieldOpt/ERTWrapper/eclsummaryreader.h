#ifndef ECLSUMMARYREADER_H
#define ECLSUMMARYREADER_H

#include <ert/ecl/ecl_sum.h>
#include <ert/ecl/ecl_smspec.h>
#include <QString>
#include <QtCore/QHash>

namespace ERTWrapper {
    namespace ECLSummary {

/*!
 * \brief The ECLSummaryReader class is a wrapper for ecl_sum in ERT. It lets you retrieve information
 * from summary files generated by eclipse.
 */
        class ECLSummaryReader
        {
        public:
            /*!
             * \brief ECLSummaryReader Reads the summary file specified in the parameter.
             * \param file_name Path to the eclipse summary, with or without file suffix.
             */
            ECLSummaryReader(QString file_name);
            ~ECLSummaryReader();

            /*!
             * \brief GetMiscVar Get a Misc var. Calls ecl_sum_get_misc_var.
             * \param var_name Name of the variable to get, e.g. TIME or YEARS.
             * \param time_index The time index (0 and up).
             * \return The value of the variable at the specified time index.
             */
            double GetMiscVar(QString var_name, int time_index);

            /*!
             * \brief GetFieldVar Get a Field variable. Calls ecl_sum_get_field_var.
             * \param var_name Name of the variable to get, e.g. FOPT or FWCT.
             * \param time_index The time index (0 and up).
             * \return The value of the variable at the specified time index.
             */
            double GetFieldVar(QString var_name, int time_index);

            /*!
             * \brief GetWellVar Get a Well variable. Calls ecl_sum_get_well_var.
             * \param well_name Name of the variable to get, e.g. WOPR or WBHP.
             * \param var_name Name of the well to which the variable belongs, e.g. "PROD" or "INJ" (must be upper-case).
             * \param time_index The time index (0 and up).
             * \return The value of the variable at the specified time index.
             */
            double GetWellVar(QString well_name, QString var_name, int time_index);

            int GetLastReportStep(); //!< Get the last report step, i.e. the highest possible time index.
            int GetFirstReportStep(); //!< Get the first report step, i.e. the lowest possible time index (usually 0).
            bool HasReportStep(int report_step); //!< Check whether the report step is valid, i.e. < last and > first.

            const QList<QString> &keys() const { return keys_; } //!< Get the list of all the keys contained in the summary.
            const QList<QString> &wells() const { return wells_; } //!< Get the list of all wells found in the summary.
            const QList<QString> &field_keys() const { return field_keys_; } //!< Get the list of all field-level keys contained in the summary.
            const QList<QString> &well_keys() const { return well_keys_; } //!< Get the list of all well-level keys contained in the summary.

            const std::vector<double> &time() const { return time_; } //!< Get the time vector (days).

            const std::vector<double> &fopt() const;
            const std::vector<double> &fwpt() const;
            const std::vector<double> &fgpt() const;
            const std::vector<double> &fwit() const;
            const std::vector<double> &fgit() const;

            const std::vector<double> wopt(const QString well_name) const;
            const std::vector<double> wwpt(const QString well_name) const;
            const std::vector<double> wgpt(const QString well_name) const;
            const std::vector<double> wwit(const QString well_name) const;
            const std::vector<double> wgit(const QString well_name) const;

            const std::vector<double> wopr(const QString well_name) const;
            const std::vector<double> wwpr(const QString well_name) const;
            const std::vector<double> wgpr(const QString well_name) const;
            const std::vector<double> wwir(const QString well_name) const;
            const std::vector<double> wgir(const QString well_name) const;

        private:
            QString file_name_;

            ecl_sum_type *ecl_sum_;

            QList<QString> keys_; //!< A list of all keys found in the summary.
            QList<QString> wells_; //!< A list of all the wells found in the summary.
            QList<QString> field_keys_; //!< A list of all the field keys found in the summary.
            QList<QString> well_keys_; //!< A list of all the well keys found in the summary.
            void populateKeyLists(); //!< Populalate the key lists using the ecl_sum_select_matching_general_var_list function.

            std::vector<double> time_;
            std::vector<double> fopt_;
            std::vector<double> fwpt_;
            std::vector<double> fgpt_;
            std::vector<double> fwit_;
            std::vector<double> fgit_;
            QHash<QString, std::vector<double>> wopt_;
            QHash<QString, std::vector<double>> wwpt_;
            QHash<QString, std::vector<double>> wgpt_;
            QHash<QString, std::vector<double>> wwit_;
            QHash<QString, std::vector<double>> wgit_;
            QHash<QString, std::vector<double>> wopr_;
            QHash<QString, std::vector<double>> wwpr_;
            QHash<QString, std::vector<double>> wgpr_;
            QHash<QString, std::vector<double>> wwir_;
            QHash<QString, std::vector<double>> wgir_;

            void initializeVectors();
            void initializeTimeVector();
            void initializeWellRates();
            void initializeWellCumulatives();
            void initializeFieldCumulatives();

            void warnPropertyZero(QString wname, QString propname) const;
            void warnPropertyNotFound(QString propname) const;
            void warnPropertyZero(QString propname) const;

            bool hasWellVar(QString well_name, QString var_name);
            bool hasGroupVar(QString group_name, QString var_name);
            bool hasFieldVar(QString var_name);
            bool hasBlockVar(int block_nr, QString var_name);
            bool hasMiscVar(QString var_name);
        };

    }
}

#endif // ECLSUMMARYREADER_H
